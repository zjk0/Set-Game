# 神奇形色牌（Set）

## 简介

四种属性，每种属性三个取值：个数（1、2、3），颜色（红、绿、紫），形状（菱形、椭圆形、波浪形），纹路（实心、条纹、空心）。

三张牌可以成为一组Set需要符合以下所有条件：

- 三张牌的数字相同，或者都不相同。
- 三张牌的颜色相同，或者都不相同。
- 三张牌的形状相同，或者都不相同。
- 三张牌的纹路相同，或者都不相同。

现在需要通过数字图像处理技术，从一系列牌中，找出所有的Set。

## 思考

首先，需要把图像中的牌找出来，然后考虑如何识别牌的四种属性，然后再判断有没有set

除了颜色这个属性，其他三个属性在灰度图像中也能识别出来，所以对于一张图像，可以有两个副本，一个副本是RGB图像，一个副本是灰度图像，RGB图像用于识别颜色属性，灰度图像用于识别形状、个数、纹路这三个属性。

### 感觉需要注意的地方

图形的纹路，我认为会对边缘检测有影响，尤其是条纹填充，可能会影响到除了颜色以外的属性的判断，所以需要先检测填充方式，在检测别的属性。

### 牌的寻找

先将图像转换为灰度图像，然后二值化，将不是纸牌的地方设置为黑色，将纸牌，包括纸牌中的内容设置为白色，然后进行连通域检测，根据不同的标签值来区别不同的纸牌。

### 颜色识别

在一张牌中，先进行canny边缘检测，找出边缘坐标，回到RGB图像，转换为HSV空间，在边缘坐标中取出一个点，判断其H值所在范围。

### 个数识别

在一张牌中，先进行基于阈值的图像分割，纸牌上的图像为黑色，因为图像的边缘不是严格的一个像素，而是一条有宽度的边，因为条纹会影响判断，但是条纹比较细，所以我认为可以这样：因为知道了内部填充，所以可以先判断填充，如果不是条纹，则进行操作A，如果是条纹，因为基于阈值的图像分割将图像整为黑色，所以采取先膨胀后腐蚀，也就是闭运算，去除条纹，填充变为空心，再进行操作A，操作A指的是：找到中心，向下遍历，如果是实心的，判断像素值变化的次数，其他填充则判断像素值由小变大的次数，从而得到图形个数。

### 纹路识别

在一张牌中，先进行canny边缘检测，然后将一张牌取出来，找到中心点，取中心点的一个邻域，计算方差，方差较大的，判断为条纹，方差较小的，判断为空心或者实心，计算平均值，如果平均值较大，判断为实心，如果平均值较小，判断为空心。

### 形状识别

在一张牌中，先进行基于边缘的图像分割，然后沿着图像的竖直中轴线，从上往下扫描，找到边缘点之后，开始遍历该边缘点所在的行的全部像素点，查找有多少个边缘点，通过这一行的边缘点的个数来判断形状。

### 注意

由于直接进行canny边缘检测有较多噪声，考虑先将图像二值化，再进行canny边缘检测。